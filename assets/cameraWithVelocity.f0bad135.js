import{n as j,s as l0,g as x0}from"./index.43060684.js";const D=(t,e)=>(console.error(t,e),new Error(t)),A0=(t,e,r)=>{const o=t.createShader(e);if(!o)throw D("error creating shader",{shader:o});if(t.shaderSource(o,r),t.compileShader(o),t.getShaderParameter(o,t.COMPILE_STATUS))return o;const c=t.getShaderInfoLog(o)||"Failed to create shader";throw t.deleteShader(o),new Error(c)},L0=(t,e,r)=>{const o=t.createProgram();if(!o)throw D("error creating program",{program:o});if(t.attachShader(o,e),t.attachShader(o,r),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS))return o;const c=t.getProgramInfoLog(o)||"Failed to create program";throw t.deleteProgram(o),new Error(c)},b0=t=>{const e=t.clientWidth,r=t.clientHeight,o=t.width!==e||t.height!==r;return o&&(t.width=e,t.height=r),o},q=t=>t*Math.PI/180,u0=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],H=(t,e)=>[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]],w0=(t,e)=>[t[0]-e[0],t[1]-e[1],t[2]-e[2]],s0=(t,e)=>[t[0]+e[0],t[1]+e[1],t[2]+e[2]],X=(t,e)=>[t[0]*e,t[1]*e,t[2]*e],O=t=>{const e=Math.sqrt(t[0]**2+t[1]**2+t[2]**2);return e>1e-5?[t[0]/e,t[1]/e,t[2]/e]:[0,0,0]},f={createProjectionMatrix:function(t,e,r){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/r,0,-1,1,0,1]},createIdentityMatrix:()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],createTranslationMatrix:(t,e,r)=>[1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1],createXRotationMatrix:t=>{const e=Math.cos(t),r=Math.sin(t);return[1,0,0,0,0,e,r,0,0,-r,e,0,0,0,0,1]},createYRotationMatrix:t=>{const e=Math.cos(t),r=Math.sin(t);return[e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1]},createZRotationMatrix:t=>{const e=Math.cos(t),r=Math.sin(t);return[e,r,0,0,-r,e,0,0,0,0,1,0,0,0,0,1]},createScalingMatrix:function(t,e,r){return[t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]},createPerspectiveMatrix(t,e,r,o){const s=Math.tan(Math.PI*.5-.5*t),c=1/(r-o);return[s/e,0,0,0,0,s,0,0,0,0,(r+o)*c,-1,0,0,r*o*c*2,0]},createLookAtMatrix:(t,e,r)=>{var o=O(w0(t,e)),s=O(H(r,o)),c=O(H(o,s));return[s[0],s[1],s[2],0,c[0],c[1],c[2],0,o[0],o[1],o[2],0,t[0],t[1],t[2],1]},_lookAt:(t,e,r)=>{var o=O(w0(t,e)),s=O(H(r,o)),c=O(H(o,s));return[s[0],s[1],s[2],0,c[0],c[1],c[2],0,o[0],o[1],o[2],0,-u0(s,t),-u0(c,t),-u0(o,t),1]},__lookAt:(t,e)=>{const o=O(H([0,1,0],e)),s=H(e,o);return f.multiply([o[0],o[1],o[2],0,s[0],s[1],s[2],0,e[0],e[1],e[2],0,0,0,0,1],[1,0,0,-t[0],0,1,0,-t[1],0,0,1,-t[2],0,0,0,1])},multiply:function(t,e){const r=4,o=e[0*r+0],s=e[0*r+1],c=e[0*r+2],a=e[0*r+3],i=e[1*r+0],l=e[1*r+1],h=e[1*r+2],u=e[1*r+3],M=e[2*r+0],x=e[2*r+1],A=e[2*r+2],_=e[2*r+3],w=e[3*r+0],S=e[3*r+1],g=e[3*r+2],E=e[3*r+3],R=t[0*r+0],T=t[0*r+1],y=t[0*r+2],v=t[0*r+3],I=t[1*r+0],L=t[1*r+1],b=t[1*r+2],k=t[1*r+3],F=t[2*r+0],P=t[2*r+1],V=t[2*r+2],B=t[2*r+3],U=t[3*r+0],C=t[3*r+1],Y=t[3*r+2],z=t[3*r+3];return[o*R+s*I+c*F+a*U,o*T+s*L+c*P+a*C,o*y+s*b+c*V+a*Y,o*v+s*k+c*B+a*z,i*R+l*I+h*F+u*U,i*T+l*L+h*P+u*C,i*y+l*b+h*V+u*Y,i*v+l*k+h*B+u*z,M*R+x*I+A*F+_*U,M*T+x*L+A*P+_*C,M*y+x*b+A*V+_*Y,M*v+x*k+A*B+_*z,w*R+S*I+g*F+E*U,w*T+S*L+g*P+E*C,w*y+S*b+g*V+E*Y,w*v+S*k+g*B+E*z]},translate:(t,e,r,o)=>f.multiply(t,f.createTranslationMatrix(e,r,o)),scale:(t,e,r,o)=>f.multiply(t,f.createScalingMatrix(e,r,o)),rotateX:(t,e)=>f.multiply(t,f.createXRotationMatrix(e)),rotateY:(t,e)=>f.multiply(t,f.createYRotationMatrix(e)),rotateZ:(t,e)=>f.multiply(t,f.createZRotationMatrix(e)),inverse:t=>{const e=4,r=t[0*e+0],o=t[0*e+1],s=t[0*e+2],c=t[0*e+3],a=t[1*e+0],i=t[1*e+1],l=t[1*e+2],h=t[1*e+3],u=t[2*e+0],M=t[2*e+1],x=t[2*e+2],A=t[2*e+3],_=t[3*e+0],w=t[3*e+1],S=t[3*e+2],g=t[3*e+3],E=x*g,R=S*A,T=l*g,y=S*h,v=l*A,I=x*h,L=s*g,b=S*c,k=s*A,F=x*c,P=s*h,V=l*c,B=u*w,U=_*M,C=a*w,Y=_*i,z=a*M,J=u*i,Q=r*w,t0=_*o,e0=r*M,r0=u*o,o0=r*i,n0=a*o,f0=E*i+y*M+v*w-(R*i+T*M+I*w),p0=R*o+L*M+F*w-(E*o+b*M+k*w),_0=T*o+b*i+P*w-(y*o+L*i+V*w),M0=I*o+k*i+V*M-(v*o+F*i+P*M),p=1/(r*f0+a*p0+u*_0+_*M0);return[p*f0,p*p0,p*_0,p*M0,p*(R*a+T*u+I*_-(E*a+y*u+v*_)),p*(E*r+b*u+k*_-(R*r+L*u+F*_)),p*(y*r+L*a+V*_-(T*r+b*a+P*_)),p*(v*r+F*a+P*u-(I*r+k*a+V*u)),p*(B*h+Y*A+z*g-(U*h+C*A+J*g)),p*(U*c+Q*A+r0*g-(B*c+t0*A+e0*g)),p*(C*c+t0*h+o0*g-(Y*c+Q*h+n0*g)),p*(J*c+e0*h+n0*A-(z*c+r0*h+o0*A)),p*(C*x+J*S+U*l-(z*S+B*l+Y*x)),p*(e0*S+B*s+t0*x-(Q*x+r0*S+U*s)),p*(Q*l+n0*S+Y*s-(o0*S+C*s+t0*l)),p*(o0*x+z*s+r0*l-(e0*l+n0*x+J*s))]}},S0=(t,e,r)=>Math.max(t,Math.min(e,r)),g0=[0,0,0,0,.5,0,.1,0,0,0,.5,0,.1,.5,0,.1,0,0,.1,0,0,.1,.1,0,.33,0,0,.1,.1,0,.33,.1,0,.33,0,0,.1,.2,0,.1,.3,0,.25,.2,0,.1,.3,0,.25,.3,0,.25,.2,0,0,0,.1,.1,0,.1,0,.5,.1,0,.5,.1,.1,0,.1,.1,.5,.1,.1,0,.1,.33,0,.1,.1,.1,.1,.1,.1,.1,.33,0,.1,.33,.1,.1,.1,.2,.1,.25,.2,.1,.1,.3,.1,.1,.3,.1,.25,.2,.1,.25,.3,.1,0,0,0,.33,0,0,.33,0,.1,0,0,0,.33,0,.1,0,0,.1,.33,0,0,.33,.1,0,.33,.1,.1,.33,0,0,.33,.1,.1,.33,0,.1,.1,.1,0,.1,.1,.1,.33,.1,.1,.1,.1,0,.33,.1,.1,.33,.1,0,.1,.1,0,.1,.2,.1,.1,.1,.1,.1,.1,0,.1,.2,0,.1,.2,.1,.1,.2,0,.25,.2,.1,.1,.2,.1,.1,.2,0,.25,.2,0,.25,.2,.1,.25,.2,0,.25,.3,.1,.25,.2,.1,.25,.2,0,.25,.3,0,.25,.3,.1,.1,.3,0,.1,.3,.1,.25,.3,.1,.1,.3,0,.25,.3,.1,.25,.3,0,.1,.3,0,.1,.5,.1,.1,.3,.1,.1,.3,0,.1,.5,0,.1,.5,.1,0,.5,0,0,.5,.1,.1,.5,.1,0,.5,0,.1,.5,.1,.1,.5,0,0,0,0,0,0,.1,0,.5,.1,0,0,0,0,.5,.1,0,.5,0],k0=[200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,200,70,120,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,80,70,200,70,200,210,70,200,210,70,200,210,70,200,210,70,200,210,70,200,210,200,200,70,200,200,70,200,200,70,200,200,70,200,200,70,200,200,70,210,100,70,210,100,70,210,100,70,210,100,70,210,100,70,210,100,70,210,160,70,210,160,70,210,160,70,210,160,70,210,160,70,210,160,70,70,180,210,70,180,210,70,180,210,70,180,210,70,180,210,70,180,210,100,70,210,100,70,210,100,70,210,100,70,210,100,70,210,100,70,210,76,210,100,76,210,100,76,210,100,76,210,100,76,210,100,76,210,100,140,210,80,140,210,80,140,210,80,140,210,80,140,210,80,140,210,80,90,130,110,90,130,110,90,130,110,90,130,110,90,130,110,90,130,110,160,160,220,160,160,220,160,160,220,160,160,220,160,160,220,160,160,220],E0=6,R0=.5;let N,n,T0,y0=f.createIdentityMatrix(),c0=q(60),F0=1e-4,P0=100;const d={w:!1,a:!1,s:!1,d:!1,space:!1,shift:!1},v0=120,W=5e-4,h0=.9;let G=0,d0=-90,m=[0,0,0],$=[0,.1,2],Z=[0,0,-1],K=[0,1,0];const V0=async()=>{if(N=document.querySelector("canvas"),!N)throw D("canvas not found",{canvas:N});if(n=N.getContext("webgl"),!n)throw D("WebGL not supported",{gl:n});C0();const[t,e]=await Promise.all([fetch("./vertex.glsl"),fetch("./fragment.glsl")]).then(([h,u])=>Promise.all([h.text(),u.text()])),r=A0(n,n.VERTEX_SHADER,t),o=A0(n,n.FRAGMENT_SHADER,e),s=L0(n,r,o);n.useProgram(s);const c=n.getAttribLocation(s,"a_position"),a=n.getAttribLocation(s,"a_color");T0=n.getUniformLocation(s,"u_matrix");const i=n.createBuffer();if(!i)throw D("error creating position buffer",{positionBuffer:i});n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,3,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(g0),n.STATIC_DRAW);const l=n.createBuffer();if(!l)throw D("error creating position buffer",{colorBuffer:l});n.bindBuffer(n.ARRAY_BUFFER,l),n.enableVertexAttribArray(a),n.vertexAttribPointer(a,3,n.UNSIGNED_BYTE,!0,0,0),n.bufferData(n.ARRAY_BUFFER,new Uint8ClampedArray(k0),n.STATIC_DRAW),m0(),a0(),requestAnimationFrame(I0)},B0=t=>{$[0]+=m[0]*t,$[1]+=m[1]*t,$[2]+=m[2]*t},U0=()=>{d.w&&(m=s0(m,X(Z,W))),d.a&&(m=l0(m,X(j(x0(Z,K)),W))),d.s&&(m=l0(m,X(Z,W))),d.d&&(m=s0(m,X(j(x0(Z,K)),W))),d.space&&(m=s0(m,X(j(K),W))),d.shift&&(m=l0(m,X(j(K),W))),m[0]*=h0,m[1]*=h0,m[2]*=h0},m0=(t=0,e=0)=>{d0+=t*v0,G+=e*v0,G=S0(-89,G,89);let r=[0,0,0];r[0]=Math.cos(q(d0))*Math.cos(q(G)),r[1]=Math.sin(q(G)),r[2]=Math.sin(q(d0))*Math.cos(q(G)),Z=j(r)},a0=()=>{const t=f.createPerspectiveMatrix(c0,n.canvas.clientWidth/n.canvas.clientHeight,F0,P0),e=s0($,Z),r=f.createLookAtMatrix($,e,K),o=f.inverse(r);y0=f.multiply(t,o)};let i0=null;const I0=t=>{i0===null&&(i0=t);const e=t-i0;i0=t,B0(e),U0(),m0(),a0(),b0(n.canvas),n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST);for(let r=0;r<E0;r++){const s=r/E0*Math.PI*2,c=Math.cos(s)*R0,a=Math.sin(s)*R0,i=f.translate(y0,c,0,a);n.uniformMatrix4fv(T0,!1,i);const l=n.TRIANGLES,h=0,u=g0.length/3;n.drawArrays(l,h,u)}requestAnimationFrame(I0)},C0=()=>{window.addEventListener("resize",()=>{a0()}),window.addEventListener("keydown",e=>{switch(e.key){case"w":d.w=!0;break;case"a":d.a=!0;break;case"s":d.s=!0;break;case"d":d.d=!0;break;case" ":d.space=!0;break;case"Shift":d.shift=!0;break}}),window.addEventListener("keyup",e=>{switch(e.key){case"w":d.w=!1;break;case"a":d.a=!1;break;case"s":d.s=!1;break;case"d":d.d=!1;break;case" ":d.space=!1;break;case"Shift":d.shift=!1;break}}),document.querySelector("#enable").addEventListener("click",()=>{N.requestPointerLock()}),document.addEventListener("pointerlockchange",()=>{const e=document.querySelector("#backdrop");document.pointerLockElement===N?e.classList.add("hide"):e.classList.remove("hide")}),N.onmousemove=e=>{const{width:r,height:o}=N.getBoundingClientRect(),s=e.movementX/r,c=-e.movementY/o;m0(s,c),a0()},window.onwheel=e=>{c0+=.01*Math.sign(e.deltaY),c0=S0(Math.PI/16,c0,Math.PI/2)}};V0();
